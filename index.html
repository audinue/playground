<title>Playground</title>

<script src="http://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.js"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/jquery-storage-api/1.7.5/jquery.storageapi.js"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/ace/1.2.3/ace.js"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/ace/1.2.3/mode-html.js"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/ace/1.2.3/mode-css.js"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/ace/1.2.3/mode-javascript.js"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/ace/1.2.3/theme-github.js"></script>

<div id="html-editor"></div>
<div id="css-editor"></div>
<div id="js-editor"></div>

<textarea id="css-textarea"></textarea>
<textarea id="js-textarea"></textarea>
<iframe id="preview-iframe"></iframe>

<style>
#html-editor {
	width: 300px;
	height: 200px;
}
</style>

<script>

$('#preview-iframe')
	.contents()
	.find('head')
	.append($('<style/>'))
	.append($('<script/>'));

function updateCSS() {
	$('#preview-iframe')
		.contents()
		.find('style')
		.html($('#css-textarea').val());
	$.localStorage.set('css', $('#css-textarea').val());
}

function updateJS() {
	var oldScript = $('#preview-iframe')
		.contents()
		.find('script')
		.get(0);
	var newScript = $('#preview-iframe')
		.get(0)
		.contentDocument
		.createElement('script');
	newScript.textContent = $('#js-textarea').val();
	oldScript
		.parentNode
		.replaceChild(newScript, oldScript);
	$.localStorage.set('js', $('#js-textarea').val());
}

$('#css-textarea')
	.on('input', updateCSS);

$('#js-textarea')
	.on('input', updateJS);

$(function() {
	var htmlEditor = ace.edit('html-editor');
	htmlEditor.setTheme("ace/theme/github");
	var htmlSession = htmlEditor.getSession();
	htmlSession.setMode("ace/mode/html");
	htmlSession.setValue(localStorage.getItem('html') || '');
	htmlSession.on('change', function() {
		$('#preview-iframe')
			.contents()
			.find('body')
			.html(htmlSession.getValue());
		localStorage.setItem('html', htmlSession.getValue());
	});
});
</script>